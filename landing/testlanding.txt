<?php
// Include file konfigurasi database
$config = include __DIR__ . '/../config/config.php'; // Sesuaikan path ke config.php

// Include class Database
require_once __DIR__ . '/../config/database.php'; // Sesuaikan path ke file Database.php

try {
    // Buat objek Database
    $database = new \Jubox\Web\Database($config);
    // Dapatkan koneksi PDO
    $koneksi = $database->getConnection();

    // Ambil data landing page dari database (misalnya, ID = 1)
    $stmt = $koneksi->prepare("SELECT * FROM landing_page WHERE id = ?");
    $stmt->execute([1]);
    $landing = $stmt->fetch(\PDO::FETCH_ASSOC) ?: []; // Array kosong jika tidak ada data
} catch (\PDOException $e) {
    $error = "Koneksi database gagal: " . $e->getMessage();
    $landing = []; // Set array kosong jika query gagal
}
?>

<!DOCTYPE html>
<html lang="id" dir="ltr" data-bs-theme="light" data-color-theme="Blue_Theme" data-layout="vertical">

<head>
  <!-- Required meta tags -->
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Favicon icon -->
  <link rel="shortcut icon" type="image/png" href="../src/assets/images/logos/logo-pnk.png"/>

  <!-- Core CSS -->
  <link rel="stylesheet" href="../src/assets/css/styles.css" />

  <title>Broker MQTT PNK</title>
  <!-- Owl Carousel -->
  <link rel="stylesheet" href="../src/assets/libs/owl.carousel/dist/assets/owl.carousel.min.css" />
  <link rel="stylesheet" href="../src/assets/libs/aos/dist/aos.css" />

  <style>
    .preloader img {
      transform: scale(3); /* Dikurangi untuk mobile */
      max-width: 100px; /* Batasi ukuran di layar kecil */
    }
    .logo-container {
      margin-left: 0; /* Dihapus untuk konsistensi di mobile */
      display: flex;
      align-items: center;
    }
    .broker-text {
      font-size: 1.25rem; /* 20px */
      font-weight: bold;
      color: #333;
      white-space: nowrap;
    }
    /* Ensure hero-img-slide container is positioned correctly */
    .hero-img-slide {
      overflow: hidden;
      position: relative;
    }
    .hero-img-slide .banner-img-1,
    .hero-img-slide .banner-img-2 {
      width: 100%;
      height: auto;
      display: none; /* Initially hide both images */
    }
    .hero-img-slide .active {
      display: block; /* Show only the active image */
    }
  </style>
</head>

<body>
  <!-- Toast -->
  <div class="toast toast-onload align-items-center text-bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-body hstack align-items-start gap-6">
      <i class="ti ti-alert-circle fs-6"></i>
      <div>
        <h5 class="text-white fs-3 mb-1">Selamat Datang di Broker MQTT</h5>
      </div>
      <button type="button" class="btn-close btn-close-white fs-2 m-0 ms-auto shadow-none" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>

  <!-- Preloader -->
  <div class="preloader">
    <img src="../src/assets/images/logos/logo-pnk.png" alt="loader" class="lds-ripple img-fluid" />
  </div>

  <div id="main-wrapper" class="flex-column">
    <!-- Header -->
    <header class="header">
      <nav class="navbar navbar-expand-lg py-0">
        <div class="container">
          <a class="navbar-brand d-flex align-items-center logo-container" href="index.php">
            <img src="../src/assets/images/logos/logo-pnk.png" class="dark-logo me-2" alt="Logo" style="width: 50px; height: auto;" />
            <span class="broker-text">Broker PNK</span>
          </a>
          <!-- Tombol Hamburger untuk Mobile -->
          <button class="navbar-toggler border-0 p-0 shadow-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <i class="ti ti-menu-2 fs-9"></i>
          </button>
          <!-- Navbar Collapse untuk Desktop -->
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav align-items-center mb-2 mb-lg-0 ms-auto" style="margin-right: 20px;">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#beranda">Beranda</a>
              </li>
              <li class="nav-item ms-2">
                <a class="nav-link" href="#production-template">Tentang</a>
              </li>
              <li class="nav-item ms-2">
                <a class="btn btn-primary fs-3 rounded btn-hover-shadow px-3 py-2" href="../login/index.php">Login</a>
              </li>
              <li class="nav-item ms-2">
                <a class="btn btn-outline-primary fs-3 rounded btn-hover-shadow px-3 py-2" href="../regis/index.php">Register</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- Offcanvas untuk Mobile -->
      <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Menu</h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
          <ul class="navbar-nav align-items-center">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#beranda" data-bs-dismiss="offcanvas">Beranda</a>
            </li>
            <li class="nav-item mt-2">
              <a class="nav-link" href="#production-template" data-bs-dismiss="offcanvas">Tentang</a>
            </li>
            <li class="nav-item mt-2">
              <a class="nav-link" href="#panduan" data-bs-dismiss="offcanvas">Panduan</a>
            </li>
            <li class="nav-item mt-2">
              <a class="btn btn-primary fs-3 rounded btn-hover-shadow px-3 py-2 w-100" href="../login/index.php">Login</a>
            </li>
            <li class="nav-item mt-2">
              <a class="btn btn-outline-primary fs-3 rounded btn-hover-shadow px-3 py-2 w-100" href="../regis/index.php">Register</a>
            </li>
          </ul>
        </div>
      </div>
    </header>

    <!-- Body Content -->
    <div class="body-wrapper overflow-hidden pt-0" id="beranda">
      <!-- Hero Section -->
      <section class="hero-section position-relative overflow-hidden mb-0 mb-lg-5">
        <div class="container">
          <div class="row align-items-center">
            <div class="col-xl-6 col-12">
              <div class="hero-content my-5 my-xl-0">
                <h1 class="fw-bolder mb-7 fs-13" data-aos="fade-up" data-aos-delay="400" data-aos-duration="1000">
                  <?php echo htmlspecialchars($landing['title'] ?? 'Broker MQTT'); ?>
                  <span class="text-primary"><?php echo htmlspecialchars($landing['description_1'] ?? 'Politeknik Negeri Kupang'); ?></span>
                </h1>
                <div class="d-sm-flex align-items-center gap-3" data-aos="fade-up" data-aos-delay="800" data-aos-duration="1000">
                  <a class="btn btn-primary px-5 py-6 btn-hover-shadow d-block mb-3 mb-sm-0" href="../login/index.php">Login</a>
                  <h5 class="mx-2">atau</h5>
                  <a class="btn btn-outline-primary d-block px-5 py-6" href="../regis/index.php">Register</a>
                </div>
              </div>
            </div>
            <!-- Hero Images (Hanya tampil di layar besar) -->
            <div class="col-xl-6 d-none d-xl-block">
              <div class="hero-img-slide position-relative bg-primary-subtle p-4 rounded">
                <div class="d-flex flex-row">
                  <div>
                    <div class="banner-img-1">
                      <img src="<?php echo htmlspecialchars($landing['image_path_1'] ?? '../src/assets/images/frontend-pages/pnk2.png'); ?>" alt="Header Image 1" class="img-fluid" />
                    </div>
                  </div>
                  <div>
                    <div class="banner-img-2">
                      <img src="<?php echo htmlspecialchars($landing['image_path_2'] ?? '../src/assets/images/frontend-pages/pnk3.png'); ?>" alt="Header Image 2" class="img-fluid" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Production Section -->
      <section class="production pb-5 pb-md-5 mb-5" id="production-template">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-lg-8" data-aos="fade-up" data-aos-delay="200" data-aos-duration="1000">
              <h2 class="text-center mb-0 fs-9 fw-bolder">
                <?php echo htmlspecialchars($landing['description_1'] ?? 'Lorem ipsum dolor sit amet, consectetur adipisicing elit.'); ?>
              </h2>
            </div>
          </div>
        </div>
      </section>

      <!-- Call to Action Section -->
      <section class="bg-primary pt-5 pb-8">
        <div class="container">
          <div class="row justify-content-center align-items-center">
            <div class="col-lg-7 col-xl-6 pt-lg-5 mb-5 mb-lg-0">
              <h2 class="fs-9 text-white text-center text-lg-start fw-bolder mb-7">
                <?php echo htmlspecialchars($landing['description_2'] ?? 'Segera hubungkan Perangkat IoT Anda Dengan Broker PNK'); ?>
              </h2>
              <div class="d-sm-flex align-items-center justify-content-center justify-content-lg-start gap-3">
                <a href="../login/index.php" class="btn bg-white text-primary fw-semibold d-block mb-3 mb-sm-0 btn-hover-shadow px-5 py-6">Login</a>
                <a href="../regis/index.php" class="btn border-white text-white fw-semibold btn-hover-white d-block px-5 py-6">Register</a>
              </div>
            </div>
            <!-- Gambar hanya tampil di layar besar -->
            <div class="col-lg-5 col-xl-6 d-none d-lg-block">
              <div class="text-center">
                <img src="../src/assets/images/backgrounds/business-woman-checking-her-mail.png" alt="modernize-img" class="img-fluid" style="max-width: 100%; height: auto;" />
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Footer -->
    <footer class="footer-part pt-7 pb-5">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-4">
            <div class="text-center">
              <a href="index.php">
                <img src="../src/assets/images/logos/logo-pnk.png" alt="modernize-img" class="img-fluid pb-3" style="width: 35px; height: auto;"/>
              </a>
              <p class="mb-0 text-dark">
                Didukung oleh ICTeam PNK 2025
              </p>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Dark Transparent Overlay -->
    <div class="dark-transparent sidebartoggler"></div>

    <!-- JavaScript Files -->
    <script src="../src/assets/js/vendor.min.js"></script>
    <script src="../src/assets/libs/simplebar/dist/simplebar.min.js"></script>
    <script src="../src/assets/js/theme/app.init.js"></script>
    <script src="../src/assets/js/theme/theme.js"></script>
    <script src="../src/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../src/assets/js/theme/app.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>
    <script src="../src/assets/libs/owl.carousel/dist/owl.carousel.min.js"></script>
    <script src="../src/assets/libs/aos/dist/aos.js"></script>
    <script src="../src/assets/js/landingpage/landingpage.js"></script>
    <script>
      // Randomly display one image on page load
      document.addEventListener('DOMContentLoaded', function() {
        const images = document.querySelectorAll('.hero-img-slide .banner-img-1, .hero-img-slide .banner-img-2');
        // Hide all images initially
        images.forEach(img => img.style.display = 'none');
        // Select a random image
        const randomIndex = Math.floor(Math.random() * images.length);
        images[randomIndex].style.display = 'block';
        images[randomIndex].classList.add('active');
      });
    </script>
</body>
</html>